---
SPDX-License-Identifier: MIT
path: "/prisma-mongodb-replica-set/enable-replica-set-mongodb-coolify"
slug: "enable-replica-set-mongodb-coolify"
title: "How to Enable a Replica Set in MongoDB on Coolify (for Prisma ORM Compatibility)"
short_description: "Learn how to enable a MongoDB replica set on Coolify to make it compatible with Prisma ORM, even for single-node deployments."
...

---

If you're using **Prisma ORM** with **MongoDB**, you may encounter an unexpected blocker: Prisma **requires MongoDB to be part of a replica set**—even if you're only running a single-node deployment. This requirement is non-negotiable, and without a replica set, Prisma simply won't work with MongoDB.

In this article, we’ll walk you through how to **enable a single-node replica set** on a MongoDB instance hosted via **Coolify** on your VPS. This is the simplest workaround for Prisma’s replica set dependency when you're not running a full production-ready MongoDB cluster.

---

## ✅ Why Prisma Requires a Replica Set

Prisma uses features like transactions and change streams, which require MongoDB to be deployed as a replica set—even if you’re using just one node. This doesn’t mean you have to set up multiple MongoDB instances; you can configure a **replica set on a single-node** MongoDB server to satisfy Prisma’s requirements.

---

## 🛠️ Setting Up a Single-Node Replica Set in MongoDB on Coolify

### Step 1: Access Your Coolify Dashboard

1. Log into your Coolify instance (running on your VPS).
2. Navigate to your deployed MongoDB service.

---

### Step 2: Generate a Secure Keyfile

The replica set requires a shared keyfile for internal authentication, even if it's just one node.

1. Go to the **Terminal tab** on the Coolify instance **where Coolify itself is running**.
2. Run the following command to generate a 741-byte base64 key:

   ```
   openssl rand -base64 741
   ```

3. Create a new file:

   ```
   nano keyfile-mongo
   ```

4. Paste the generated key and save the file.
5. Secure the keyfile with proper permissions:

   ```
   chmod 400 keyfile-mongo
   chown 999:999 keyfile-mongo
   ```

6. Create a directory to store the keyfile and move it there:

   ```
   mkdir -p /root/replica
   mv keyfile-mongo /root/replica/replica.key
   ```

---

### Step 3: Mount the Keyfile in Your MongoDB Instance

1. In the Coolify dashboard, open your MongoDB instance.
2. Go to **Persistent Storage**.
3. Click **+ Add** to add a new volume:

   - **Name**: `replica`
   - **Source Path**: `/root/replica`
   - **Destination Path**: `/tmp/mongodb`

This mounts your keyfile inside the MongoDB container.

---

### Step 4: Enable Replica Set Initialization

1. Go to the **Terminal** tab for your MongoDB instance.
2. Launch the MongoDB shell and run:

   ```js
   rs.initiate({
     _id: "rs0",
     members: [{ _id: 0, host: "localhost:27017" }],
   });
   ```

> **Note:** If your MongoDB instance is running on a different port, replace `27017` accordingly.

---

### Step 5: Update the MongoDB Configuration

1. Go to the **Configuration** tab for your MongoDB instance.
2. Scroll down to **Custom MongoDB Configuration**, and enter:

   ```yaml
   replication:
     replSetName: "rs0"
   security:
     authorization: enabled
     keyFile: /tmp/mongodb/replica.key
   ```

3. Save and restart your MongoDB service.

---

## 🧪 Testing the Setup

After restarting MongoDB:

- Connect using `mongosh` or a MongoDB GUI.
- Run:

  ```js
  rs.status();
  ```

- Confirm that the replica set is active.
- Test your Prisma application to ensure the connection works.

---

## 🚀 Optional: Production Considerations

This tutorial sets up a **single-node replica set** to satisfy Prisma’s requirements. For high availability and production-grade environments, consider setting up a **three-node replica set** across separate containers or servers.

---

## ✅ Conclusion

You've now configured MongoDB with a **single-node replica set** in Coolify, ensuring full compatibility with Prisma ORM—without the complexity of managing multiple MongoDB instances. This setup is ideal for local development, staging, or lightweight production use cases.

When you're ready to scale, transitioning to a true multi-node replica set will be straightforward.

---

## 💡 Quick Summary

| Step | Action                                                    |
| ---- | --------------------------------------------------------- |
| 1    | Generate keyfile using OpenSSL                            |
| 2    | Mount the keyfile to MongoDB via Coolify’s volume system  |
| 3    | Initiate the replica set via the MongoDB shell            |
| 4    | Update MongoDB configuration for replication and security |
| 5    | Restart and test                                          |

##### License: MIT

<!--

Contributor's Certificate of Origin

By making a contribution to this project, I certify that:

(a) The contribution was created in whole or in part by me and I have
    the right to submit it under the license indicated in the file; or

(b) The contribution is based upon previous work that, to the best of my
    knowledge, is covered under an appropriate license and I have the
    right under that license to submit that work with modifications,
    whether created in whole or in part by me, under the same license
    (unless I am permitted to submit under a different license), as
    indicated in the file; or

(c) The contribution was provided directly to me by some other person
    who certified (a), (b) or (c) and I have not modified it.

(d) I understand and agree that this project and the contribution are
    public and that a record of the contribution (including all personal
    information I submit with it, including my sign-off) is maintained
    indefinitely and may be redistributed consistent with this project
    or the license(s) involved.

Signed-off-by: [Satish <satish@technotip.org>]

-->
