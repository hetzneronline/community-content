---
SPDX-License-Identifier: MIT
path: "/tutorials/how-to-add-swap-space-on-centos-7"
slug: "how-to-add-swap-space-on-centos-7"
date: "2019-08-11"
title: "How to Add Swap Space on CentOS 7"
short_description: "This tutorial explains how to add swap space on CentOS 7"
tags: ["Nginx", "SSL", "Let's Encrypt", "Debian"]
author: "MohammadHossein Fakhraei"
author_link: "https://github.com/1817666"
author_img: "https://avatars1.githubusercontent.com/u/39782157"
author_description: ""
language: "en"
available_languages: ["en"]
header_img: "header-3"
---

## Introduction

Swap is a space on a disk that is used when the amount of physical RAM memory is full. When a Linux system runs out of RAM, inactive pages are moved from the RAM to the swap space.

**Prerequisites**

To add swap space on CentOS 7 make sure you are logged into your server with a `sudo` user.

## Step 1 - Checking the System for Swap Information

Before proceeding with this tutorial, check if your CentOS installation already has swap enabled by typing:

```bash
swapon --show
```

If you don't get back any output, this means your system does not have swap space available currently.

You can verify that there is no active swap using the free utility:

```bash
free -h
```

Output:

```bash
# free -h
              total        used        free      shared  buff/cache   available
Mem:           1.7G        226M        138M        104M        1.4G        1.2G
Swap:            0B          0B          0B
```

As you can see in the **Swap** row of the output, no swap is active on the system.

## Step 2 - Checking Available Space on the Hard Drive Partition

Before we create our swap file, we'll check our current disk usage to make sure we have enough space. Do this by entering:

```bash
df -h
```

Sample Output:

```
# df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        19G  6.5G   12G  37% /
devtmpfs        871M     0  871M   0% /dev
tmpfs           896M     0  896M   0% /dev/shm
tmpfs           896M  105M  791M  12% /run
tmpfs           896M     0  896M   0% /sys/fs/cgroup
tmpfs           180M     0  180M   0% /run/user/0
```

The device with `/` in the `Mounted on` column is our disk in this case. We have plenty of space available in this example (only 6.5G used). Your usage will probably be different.

## Step 3 - Creating a Swap File

The best way of creating a swap file is with the `fallocate` program. This command instantly creates a file of the specified size.

Since the server in our example has 2G of RAM, we will create a 2G file in this tutorial. Adjust this to meet the needs of your own server:

```bash
fallocate -l 2G /swapfile
```

We can verify that the correct amount of space was reserved by typing:

```bash
ls -lh /swapfile
```

Sample Output:

```bash
# ls -lh /swapfile
-rw-r--r--. 1 root root 2.0G Aug 11 16:28 /swapfile
```

Our file has been created with the correct amount of space set aside.

## Step 4 - Enabling the Swap File

Now that we have a file of the correct size available, we need to actually turn this into swap space.

Make the file only accessible to root by typing:

```bash
chmod 600 /swapfile
```

Verify the permissions change by typing:

```bash
# ls -lh /swapfile
-rw-------. 1 root root 2.0G Aug 11 16:28 /swapfile
```

We can now mark the file as swap space by typing:

```bash
mkswap /swapfile
```

Sample Output:

```bash
# mkswap /swapfile
Setting up swapspace version 1, size = 2097148 KiB
no label, UUID=a849f951-e447-40a6-8556-8db52afc43d8
```

After marking the file, we can enable the swap file, allowing our system to start using it:

```bash
swapon /swapfile
```

Verify that the swap is available by typing:

```bash
swapon --show
```

Sample Output:

```bash
# swapon --show
NAME      TYPE SIZE USED PRIO
/swapfile file   2G   0B   -2
```

We can check the output of the free utility again to corroborate our findings:

```bash
free -h
```

Sample Output:

```bash
# free -h
              total        used        free      shared  buff/cache   available
Mem:           1.7G        226M        138M        104M        1.4G        1.2G
Swap:          2.0G          0B        2.0G
```

## Step 5 - Making the Swap File Permanent

Our recent changes have enabled the swap file for the current session. However, if we reboot, the server will not retain the swap settings automatically. We can change this by adding the swap file to our `/etc/fstab` file.

Add the swap file information to the end of your `/etc/fstab` file by typing:

```bash
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

## Step 6 - Adjusting the Swappiness Value

Swappiness is a Linux kernel property that defines how often the system will use the swap space. Swappiness can have a value between 0 and 100. A low value will make the kernel to try to avoid swapping whenever possible while a higher value will make the kernel to use the swap space more aggressively.

The default swappiness value on CentOS 7 is 30. You can check the current swappiness value by typing the following command:

```bash
cat /proc/sys/vm/swappiness
```

Sample Output:

```bash
# cat /proc/sys/vm/swappiness
30
```

While the swappiness value of 30 is OK for desktop and development machines, for production servers you may need to set a lower value.

We can set the swappiness to a different value by using the `sysctl` command.

```bash
sysctl vm.swappiness=10
```

Sample Output:

```bash
# sysctl vm.swappiness=10
vm.swappiness = 10
```

The optimal swappiness value depends on your system workload and how the memory is being used. You should adjust this parameter in small increments to find an optimal value.

This setting will persist until the next reboot. We can set this value automatically at restart by adding the line to our /etc/sysctl.conf file:

```
vi /etc/sysctl.conf
```

At the bottom, you can add:

```bash
vm.swappiness=10
```

Save and close the file when you are finished.

## Step 7 - Removing a Swap File

To deactivate and remove the swap file, follow these steps:

Deactivating the swap space by typing:

```bash
swapoff -v /swapfile
```

Next, remove the swap file entry `/swapfile none swap sw 0 0` from the `/etc/fstab` file.

Finally, delete the actual swapfile file:

```bash
rm /swapfile
```

## Conclusion

You have learned how to add a swap space, activate and configure swap space on your CentOS 7 system.

##### License: MIT

<!---

Contributors's Certificate of Origin

By making a contribution to this project, I certify that:

(a) The contribution was created in whole or in part by me and I have
    the right to submit it under the license indicated in the file; or

(b) The contribution is based upon previous work that, to the best of my
    knowledge, is covered under an appropriate license and I have the
    right under that license to submit that work with modifications,
    whether created in whole or in part by me, under the same license
    (unless I am permitted to submit under a different license), as
    indicated in the file; or

(c) The contribution was provided directly to me by some other person
    who certified (a), (b) or (c) and I have not modified it.

(d) I understand and agree that this project and the contribution are
    public and that a record of the contribution (including all personal
    information I submit with it, including my sign-off) is maintained
    indefinitely and may be redistributed consistent with this project
    or the license(s) involved.

Signed-off-by: MohammadHossein Fakhraei <eng.fakhraei@gmail.com>

-->
