---
SPDX-License-Identifier: MIT
path: "/tutorials/create-secure-ubuntu-18-04-snapshot"
slug: "create-secure-ubuntu-18-04-snapshot"
date: "2019-10-05"
title: "Create A Secure Ubuntu 18.04 Snapshot on Hetzner Cloud"
short_description: "This tutorial has step-by-step instructions to create a Ubuntu 18.04 snapshot hardened to the CIS standard that can be used as a secure base for Ubuntu servers."
tags: ["Development", "Lang:Python"]
author: "Rob Ericsson"
author_link: "https://github.com/rericsson"
author_img: "https://avatars3.githubusercontent.com/u/4484005?s=400&v=4"
author_description: ""
language: "en"
available_languages: ["en"]
header_img: "header-3"
---

## Introduction

Security is a very difficult challenge to implment properly. This tutorial shows how to leverage [Hashicorp Packer](https://www.packer.io/), [Chef](https://www.chef.sh/) and [Inspec](https://www.inspec.io/) to create a snapshot of baseline Ubuntu 18.04 that adheres to the [DevSec Hardening Framework](https://dev-sec.io/) as a snapshot in Hetzner Cloud. This snapshot can be used to create new secured servers in Hetzner Cloud for your use.  

**Prerequisites**

To follow the steps in this tutorial, you will need the following:
* A basic understanding of Hetzner Cloud. You should know what a server and snapshot are and how they relate to each other.
* You should have an active Hetzner Cloud account and an API token generated on your Hetzner project.
* A local system where you can install Hasicorp Packer, Chef and Inspec. Some basic knowledge of these tools is useful but not essential as we will go through the tutorial step-by-step. 
* You will also need access to Git so you can download files from GitHub

This tutorial was written using a Ubuntu 16.04 system. If you are working on a different Linux variant or Windows, the details will differ but the basic steps are the same.

## Step 1 - Install Hashicorp Packer

First, [download](https://www.packer.io/downloads.html) the appropriate package for your system. Packer is provided as a zip file. 

Next, unzip the downloaded package into a directory where Packer will be installed. On Linux, ~/packer or /usr/local/packer is generally good, depending on whether you want to restrict the install to just your user or install it system-wide. On Windows systems, you can put it wherever you'd like. The packer (or packer.exe for Windows) binary is all that is necessary to run Packer. 

After unzipping the package, the directory should contain a single binary program called packer. The final step to installation is to make sure the directory you installed Packer to is on the PATH. See [this](https://stackoverflow.com/questions/14637979/how-to-permanently-set-path-on-linux-unix) for instructions on setting the PATH on Linux. [This](https://stackoverflow.com/questions/1618280/where-can-i-set-path-to-make-exe-on-windows) has instructions for setting the PATH on Windows.

Test your install by opening a command line and typing:

'''packer --version'''

If you get a result, you have successfully installed Packer.

## Step 2 - Install Chef Workstation 

First, [download](https://downloads.chef.io/chef-workstation/stable) the appropriate Chef Workstation files for your system. 

The Chef Workstation download will be in an installer format appropriate for the selected system. Install it as you would any .rpm or .deb on Linux or any .msi file on Windows. 

Test your install by opening a command line and typing:

'''chef --version'''

If you get a result, you have successfully installed Chef Workstation.


## Step 3 - Git Packer Script and Chef Cookbooks

To create our secure snapshot, we are going to use Packer with the Inspec and Chef provisioners. We will use Chef to harden the default image to comply with the DevSec Linux Security Baseline. The DevSec Linux Security Baseline establishes some basic Linux hardening practices. These include attack surface reduction, secure configuration and core component configuration. Inspec tests the snapshot after it has been hardened to ensure that it conforms to the given security specification. 

Download files from GitHub

Let's take a look at the files to understand how this works...

Make sure the Packer script is valid that using the command:

'''
packer validate example.json
'''

You should see that the template validated successfully and you are ready to run it and create a snapshot.

## Step 4 - Create Hetzner Snapshot

Run the script

'''
packer build example.json
'''

When the script is run, you should see output that follows the execution. 

After you have successfully run the Packer script, you will have a new snapshot created on Hetzner Cloud. 

## Step 5 - Start Server From Snapshot

Now, start a server from the snapshot...

After the snapshot has started, you can check that it complies with the Dev Sec Baseline by running Inspec on it...


## Conclusion

There is more to secure computing practice than just hardening. You need to apply the latest patches, monitor the systems and proactively reduce vulnerabilities. After going through this tutorial, you now have a Ubuntu 18.04 snapshot in your Hetzner project that can be used to create servers that comply with the Dev Sec Linux Security Baseline. You can use this snapshot as the foundation for any Ubunutu 18.04 servers you create on Hetzner Cloud with the knowledge that the servers are hardened against attack and can serve as a starting point for secure computing practices. 


##### License: MIT

<!--

Contributor's Certificate of Origin

By making a contribution to this project, I certify that:

(a) The contribution was created in whole or in part by me and I have
    the right to submit it under the license indicated in the file; or

(b) The contribution is based upon previous work that, to the best of my
    knowledge, is covered under an appropriate license and I have the
    right under that license to submit that work with modifications,
    whether created in whole or in part by me, under the same license
    (unless I am permitted to submit under a different license), as
    indicated in the file; or

(c) The contribution was provided directly to me by some other person
    who certified (a), (b) or (c) and I have not modified it.

(d) I understand and agree that this project and the contribution are
    public and that a record of the contribution (including all personal
    information I submit with it, including my sign-off) is maintained
    indefinitely and may be redistributed consistent with this project
    or the license(s) involved.

Signed-off-by: Rob Ericsson rob@l10systems.com
