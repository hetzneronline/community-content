---
SPDX-License-Identifier: MIT
path: "/tutorials/build-multi-protocol-vpn/"
slug: "build-multi-protocol-vpn"
date: "2025-01-01"
title: "How to Build a Multi-Protocol VPN Gateway for Mixed Client Environments with SoftEther VPN"
short_description: "Learn how to set up a multi-protocol VPN gateway with SoftEther VPN, supporting OpenVPN, L2TP/IPsec, SSTP, and more for diverse client environments."
tags: ["VPN", "SoftEther", "Networking", "L2TP/IPsec", "OpenVPN", "SSTP"]
author: "Stephen Ndegwa"
author_link: "https://github.com/stephenndegwa"
author_img: "https://avatars.githubusercontent.com/u/105418748"
author_description: "System administrator with expertise in Linux, networking, and high-availability systems."
language: "en"
available_languages: ["en"]
header_img: "header-multi-protocol-vpn"
cta: "product"
---

## Introduction

This tutorial will guide you through creating a multi-protocol VPN gateway for mixed client environments using SoftEther VPN. 

By the end of this tutorial, you will have a fully functional VPN gateway capable of supporting multiple protocols. This guide assumes a basic understanding of Linux server management.

---

## Prerequisites

- A Linux server with root or sudo access. Use `<10.0.0.1>` as the server’s IP address in this tutorial.
- A domain or subdomain pointing to your server, e.g., `<vpn.example.com>`.
- Basic knowledge of networking and VPN concepts.
- Tools:
  - SSH client (e.g., PuTTY, OpenSSH)
  - Text editor (e.g., nano, vim)

---

## Steps

### Step 1: Update System Packages

Ensure your system packages are up-to-date.

```bash
sudo apt update && sudo apt upgrade -y
```

---

### Step 2: Install SoftEther VPN Server

1. Download the latest version of SoftEther VPN Server from the [SoftEther GitHub Releases](https://github.com/SoftEtherVPN/SoftEtherVPN/releases).

   ```bash
   wget https://github.com/SoftEtherVPN/SoftEtherVPN/releases/download/5.02.5187/SoftEtherVPN-5.02.5187.tar.xz
   ```

2. Extract the downloaded file and navigate to the directory.

   ```bash
   tar -xf SoftEtherVPN-5.02.5187.tar.xz
   cd SoftEtherVPN-5.02.5187
   ```

3. Install the necessary dependencies.

   ```bash
   sudo apt install -y pkg-config build-essential cmake libssl-dev libreadline-dev zlib1g-dev libsodium-dev
   ```

4. Configure and build SoftEther VPN.

   ```bash
   ./configure
   make -C build
   ```

5. Move the server files and set permissions.

   ```bash
   sudo mv build/* /usr/local/vpnserver
   sudo chmod 600 /usr/local/vpnserver/*
   sudo chmod 700 /usr/local/vpnserver/vpnserver
   sudo chmod 700 /usr/local/vpnserver/vpncmd
   sudo chmod 700 /usr/local/vpnserver/vpnbridge
   sudo chmod 700 /usr/local/vpnserver/vpnclient
   ```

6. Add SoftEther binaries to the system’s PATH.

   ```bash
   export PATH=$PATH:/usr/local/vpnserver
   echo 'export PATH=$PATH:/usr/local/vpnserver' >> ~/.bashrc
   source ~/.bashrc
   ```

7. Create and enable the SoftEther VPN service.

   ```bash
   sudo nano /etc/systemd/system/softether-vpnserver.service
   ```

   Add the following content:

   ```bash
   [Unit]
   Description=SoftEther VPN Server
   After=network.target

   [Service]
   Type=forking
   ExecStart=/usr/local/vpnserver/vpnserver start
   ExecStop=/usr/local/vpnserver/vpnserver stop
   WorkingDirectory=/usr/local/vpnserver
   Restart=always

   [Install]
   WantedBy=multi-user.target
   ```

   Save the file, reload the systemd daemon, and enable the service.

   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable softether-vpnserver
   sudo systemctl start softether-vpnserver
   ```

---

### Step 3: Configure the VPN Server

1. Start and verify the VPN server.

   ```bash
   sudo systemctl status softether-vpnserver
   ```

2. Set the administrator password using `vpncmd`.

   ```bash
   vpncmd
   ```

   Follow these steps in `vpncmd`:

   - Select option `1` (Management of VPN Server or VPN Bridge).
   - Specify the server's hostname or IP address. Press **Enter** for the default.
   - Run the following command to set the administrator password:

     ```bash
     ServerPasswordSet
     ```

     Enter the desired password when prompted.

---

### Step 4: Create a Virtual Hub

1. Use `vpncmd` to create a Virtual Hub named `VPN`.

   ```bash
   VPN Server>HubCreate VPN
   ```

2. Select the Virtual Hub.

   ```bash
   Hub VPN
   ```

---

### Step 5: Enable SecureNAT

1. Enable SecureNAT for NAT and DHCP functionality.

   ```bash
   VPN Server/vpn>SecureNatEnable
   ```

2. Configure DHCP settings for SecureNAT.

   ```bash
   VPN Server/vpn>DhcpSet
   ```

   Set options such as:
   - **Start Point for Distributed Address Band**: `192.168.10.1`
   - **End Point for Distributed Address Band**: `192.168.10.255`
   - **DNS Server 1**: `8.8.8.8`
   - **DNS Server 2**: `1.1.1.1`

---

### Step 6: Set Up Users and Passwords

1. Create a new user in the Virtual Hub.

   ```bash
   VPN Server/vpn>UserCreate
   ```

   When prompted, provide the following:
   - **User Name**: `user1`
   - **Assigned Group Name**: (leave empty)
   - **User Full Name**: (optional)
   - **User Description**: (optional)

2. Set the password for the new user.

   ```bash
   VPN Server/vpn>UserPasswordSet user1
   ```

   Enter the desired password for the user when prompted.

---

### Step 7: Enable L2TP/IPsec

1. Enable L2TP/IPsec using `vpncmd`.

   ```bash
   VPN Server/vpn>IPsecEnable
   ```

   Configure options such as:
   - **Enable L2TP over IPsec Server Function**: `y`
   - **Enable EtherIP / L2TPv3 over IPsec Server Function**: `y`
   - **Pre-Shared Key for IPsec**: `mysecurepsk`

---

### Step 8: Enable IP Forwarding

1. Check if IP forwarding is enabled.

   ```bash
   sysctl net.ipv4.ip_forward
   ```

   If it’s not enabled (`net.ipv4.ip_forward = 0`), edit the file `/etc/sysctl.conf` and add:

   ```bash
   net.ipv4.ip_forward = 1
   ```

2. Apply the configuration.

   ```bash
   sysctl -p
   ```

---

### Step 9: Configure Firewall and NAT Rules

1. Allow necessary ports through the firewall.

   ```bash
   sudo ufw allow 1194/udp
   sudo ufw allow 1701/udp
   sudo ufw allow 4500/udp
   sudo ufw allow 500/udp
   sudo ufw allow 443/tcp
   ```

2. Restart UFW to apply changes.

   ```bash
   sudo ufw reload
   ```

---
### Step 10: Connecting to the VPN Server (L2TP/IPsec Example)

To connect to the VPN server using L2TP/IPsec, follow these steps:

#### For Windows

1. Open **Settings** > **Network & Internet** > **VPN**.
2. Click **Add a VPN connection** and fill in the following:
   - **VPN provider**: Windows (built-in)
   - **Connection name**: Any name (e.g., `SoftEther L2TP VPN`)
   - **Server name or address**: `<vpn.example.com>` (your domain or server IP)
   - **VPN type**: L2TP/IPsec with pre-shared key
   - **Pre-shared key**: The key you configured (e.g., `mysecurepsk`)
   - **Type of sign-in info**: Username and password
   - **Username**: The user you created (e.g., `user1`)
   - **Password**: The password you set for this user

3. Save the settings and click on the new VPN connection to connect.

#### For macOS

1. Open **System Preferences** > **Network**.
2. Click the **+** button at the bottom left to add a new connection.
   - **Interface**: VPN
   - **VPN Type**: L2TP over IPsec
   - **Service Name**: Any name (e.g., `SoftEther L2TP VPN`)

3. Fill in the following:
   - **Server Address**: `<vpn.example.com>` (your domain or server IP)
   - **Account Name**: The user you created (e.g., `user1`)

4. Click **Authentication Settings**:
   - **Password**: The user's password.
   - **Shared Secret**: The pre-shared key (e.g., `mysecurepsk`).

5. Save the settings and click **Connect**.

#### For Android

1. Go to **Settings** > **Connections** > **VPN** > **Add VPN**.
2. Fill in the following:
   - **Name**: Any name (e.g., `SoftEther L2TP VPN`)
   - **Type**: L2TP/IPsec PSK
   - **Server address**: `<vpn.example.com>` (your domain or server IP)
   - **IPsec pre-shared key**: The pre-shared key (e.g., `mysecurepsk`)
   - **Username**: The user you created (e.g., `user1`)
   - **Password**: The password you set for this user

3. Save and connect.

#### For iOS

1. Go to **Settings** > **General** > **VPN** > **Add VPN Configuration**.
2. Choose:
   - **Type**: L2TP
   - **Server**: `<vpn.example.com>` (your domain or server IP)
   - **Account**: The user you created (e.g., `user1`)
   - **Password**: The user's password.
   - **Secret**: The pre-shared key (e.g., `mysecurepsk`).

3. Save and toggle the VPN switch to connect.

---


## Conclusion

You have successfully configured a multi-protocol VPN gateway using SoftEther VPN. This setup supports diverse client environments, enhancing connectivity options for your users.

---
### License: MIT

<!--

Contributor's Certificate of Origin

By making a contribution to this project, I certify that:

(a) The contribution was created in whole or in part by me and I have

    the right to submit it under the license indicated in the file; or

(b) The contribution is based upon previous work that, to the best of my

    knowledge, is covered under an appropriate license and I have the

    right under that license to submit that work with modifications,

    whether created in whole or in part by me, under the same license

    (unless I am permitted to submit under a different license), as

    indicated in the file; or

(c) The contribution was provided directly to me by some other person

    who certified (a), (b) or (c) and I have not modified it.

(d) I understand and agree that this project and the contribution are

    public and that a record of the contribution (including all personal

    information I submit with it, including my sign-off) is maintained

    indefinitely and may be redistributed consistent with this project


    or the license(s) involved.

Signed-off-by: Stephen Ndegwa - sndegwa@hostraha.com

-->