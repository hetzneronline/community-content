---
SPDX-License-Identifier: MIT
path: "/tutorials/setup-ubuntu-20-04"
slug: "setup-ubuntu-20-04"
date: "2021-09-16"
title: "Setup Ubuntu 20.04"
short_description: "Initial Ubuntu 20.04 server setup."
tags: ["Ubuntu 20.04", "Server Setup", "Ubuntu", "Security"]
author: "Johannes Pirmann"
author_link: "https://github.com/johannes-pirmann"
author_img: "https://avatars3.githubusercontent.com/u/26026645"
author_description: "Python developer at Pirmann Media "
language: "en"
available_languages: ["en"]
header_img: "header-8"
cta: "dedicated"
---

## EInführung

In diesem Tutorial werden sie erfahren, wie man ein Ubuntu Server aufsetzt. Das beinhaltet das erstellen eines non-root users (User ohne admin Berechtigungen), das aktivieren von SSH, deaktivieren, dammit sich der root user nichtmehr anmelden kann und das erstellen einer einfachen Firewall.

## 1. Schritt - Einlogen am Server

Melde dich als root user über ssh an deinem neu erstellten Ubuntu 20.04 server an:

```shell
ssh root@10.0.0.1
```

>Falls sie für die Anmeldung einen SSH Key verwendets, welcher nicht ihr standart SSH key ist, müssen sie noch OpenSSH den Speicherort des PrivateKeys mitgeben
```shell
ssh -i /path/to/ssh/key root@10.0.0.1
```

## 2. Schritt - Erstellen eines non-root Bneutzers

Es wird empfohlen nicht einen root user für die normalen tasks zu benutzen. Darum erstellen wir jetzt einen non-root user.
In zukunft werden wir uns nurnoch mit diesem User am Server anmelden

Gebe diesen Command ein um einen neuen user hinzuzufügen

```shell
root@10.0.0.1:~$ adduser holu
```

Nun werden sie aufgefordert, verschiedenste Informationen anzugeben
Als erstest müssen sie ein starkes Passwort festlegen. Alle anderen Informationen können sie ausfüllen wenn sie möchstest oder durch das drücken von ```ENTER``` überschpringen.

## 3. Schritt - Hinzufügen des neu erstellten Users in die sudo Gruppe

Unser neu erstellter User hat zum aktuellen Zeitpunkt nur normale Berechtigungen. Da wir allerdings beabsichtigen ihn als unseren hauptuser zu verwenden, werden wir auch Adminprivilegen benötigen. Dammit wir überhaupt in der Lage sind commands, welche Administratoren privilegien benötigen auszuführen müssen wir unseren user in die **sudo** Gruppe hinzufügen

Um dies zu machen führen wir als root user angemeldet folgenden Command aus

```shell
root@10.0.0.1:~$ usermod -aG sudo holu
```

## 4. Schritt - Sich mit dem neuen User anmelden

Um sich vom Server als root User abzumelden führen sie folgenden Command aus.

```shell
root@10.0.0.1:~$  exit
```

Anschlissend können wir uns mit unseren neu erstellten User am Server anmelden:

```shell
ssh holu@10.0.0.1
```

Now that we are logged in as a non-root user we need to use **sudo** in front of administrative commands.

## 5. Schritt - Aktivieren einer einfachen Firewall

Nachdem wir einen non-root Benutzer erstellt haben möchten wir nun die Firewall aktivieren. Dafür werden wir ```ufw``` verwenden.

### Schritt 5.1 - Auflisten aller verfügbaren Applicationen

Als erstes werden wir alle verfügbaren Applicationen auflisten, welche wir mit der Firewall registrieren können

Sie können die verfügbaren Applicationen mit folgendem command auflisten:

```shell
holu@10.0.0.1:~$ sudo ufw app list
```

Der Output sollte folgendermassen aussehen:

```shell
Available applications:
  OpenSSH
```

### Schritt 5.2 - Zulassen von OpenSSH

Da wir beabsichtigen auch zukünftig ```SSH``` zu verwenden um uns an unserem Server anzumelden müssen wir das ganze zuerst zulassen bevor wir die Firewall aktivieren:

```shell
holu@10.0.0.1:~$ sudo ufw allow OpenSSH
```

### Scritt 5.3 - Aktivieren der Firewall

Nachdem wir ```SSH``` zuglassen haben können wir die Firewall endlich aktivieren:

```shell
holu@10.0.0.1:~$ sudo ufw enable
```

Als nächstes checken wir den Status der Firewall, um zu überprüfen ob auch alles korrekt aufgestartet ist:

```shell
holu@10.0.0.1:~$ ufw status
```

```shell
Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
```

Die Firewall blockiert nun alle inkommenden Verbindungen mit ausnahme von SSH

>Falls wir eine neue Application auf dem Server installieren müssen wir sie an der Firewall aktivieren. Ansonsten würden ihre Verbindungen von der Firewall blockiert

## 6. Schritt - Hinzufügen der SSH Keys

Erstellen sie ein SSH Keypair auf deinem localen Computer (fallst sie dass nicht bereits schon getan haben).

Nun kopieren sie den SSH Key von ihrem localen PC auf den Server mit der Hilfe von folgendem Command.

```shell
cat ~/.ssh/ssh_key.pub | ssh holu@10.0.0.1 "mkdir -p ~/.ssh && chmod 700 ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"
```

- Ersetze ```~/.ssh/ssh_key.pub``` mit dem Dateipfand zu dem öffentlichen Key.
- Ersetze ```holu``` mit dem neu erstellten User 
- Ersetze 10.0.0.1 mit der IP Adresse vom Server.

## 7. Schritt - Editieren der SSH Configuration

Da wir nun ```SSH``` zum Einloggen verwenden müssen wir nun noch die Anmeldung per Passwort und die Anmeldung mit dem root User deaktiviern .

Dafür müssen wir das File ```/etc/ssh/sshd_config``` editieren:

```shell
holu@10.0.0.1:~$ sudo nano /etc/ssh/sshd_config
```

### Schritt 7.1 - Deaktivieren der Passwort Authentifizierung

Suchen sie im File folgende Linie:

```config
PasswordAuthentication yes
```

Und ändern sie sie zu:

```config
PasswordAuthentication no
```

### Schritt 7.2 - Deaktivieren des root logins

Suchen sie im File folgende Linie:
```config
PermitRootLogin yes
```

Und ändern sie sie zu:
```config
PermitRootLogin no
```

### Schritt 7.3 - Neustart des sshd Services

Speichern sie das File und schlissen sie anschlissend den Editor<>

Starten sie den sshd Service mit folgendem Befehl neu:

```shell
holu@10.0.0.1:~$ sudo systemctl restart ssh
```

## 8. Schritt - Erstellen einer SSH Konfigurationsdatei (Optional)

>Für Mac/Linux:

Erstellen sie eine ```SSH```  Konfigurationsdatei auf ihrem localen Computer. Dabei geben wir dem Computer an, wo es die SSH Keys finden kann. Dadurch brauchen wir diese nicht jedesmal mitgeben wenn wir uns auf den Server verbinden 

Führen sie folgenen Command auf ihrem localen PC aus:

```shell
sudo nano ~/.ssh/config
```

Fügen sie folgende Linien hinzu. Wobei sie das ganze an die IP Adresse von ihrem Server und den Speicherort ihres SSH Keys anpassen.

```config
HOST 10.0.0.1
IdentityFile ~/.ssh/SSH-key
```
Nun wird es automatisch den richtigen SSH Key finden wenn sie sich das nächste mal an ihrem Server anmelden

## Zusammenfassung

Wir haben nun einen simplen Ubuntu 20.04 server aufgesetzt. Dafür haben wir einen non-root User erstellt und die ```ufw``` firewall aktiviert.

##### License: MIT

<!--

Contributor's Certificate of Origin

By making a contribution to this project, I certify that:

(a) The contribution was created in whole or in part by me and I have
    the right to submit it under the license indicated in the file; or

(b) The contribution is based upon previous work that, to the best of my
    knowledge, is covered under an appropriate license and I have the
    right under that license to submit that work with modifications,
    whether created in whole or in part by me, under the same license
    (unless I am permitted to submit under a different license), as
    indicated in the file; or

(c) The contribution was provided directly to me by some other person
    who certified (a), (b) or (c) and I have not modified it.

(d) I understand and agree that this project and the contribution are
    public and that a record of the contribution (including all personal
    information I submit with it, including my sign-off) is maintained
    indefinitely and may be redistributed consistent with this project
    or the license(s) involved.

Signed-off-by: Yannick Müller contact@ynnk.dev

-->
