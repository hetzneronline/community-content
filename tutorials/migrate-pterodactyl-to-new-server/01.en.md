---
SPDX-License-Identifier: MIT
path: "/tutorials/migrate-pterodactyl-to-new-server"
slug: "migrate-pterodactyl-to-new-server"
date: "2022-07-28"
title: "Migrating Pterodactyl panel and Wings to a new server"
short_description: "This guide explains how to migrate Pterodactyl and Wings without losing any customizations made to the panel or to Wings."
tags: ["Pterodactyl", "Wings", "panel", "Migration", "Gameserver"]
author: "Niels Leemans"
author_link: "https://github.com/nielsleemans"
author_img: "https://avatars.githubusercontent.com/u/66691984"
author_description: "I learned Linux thanks to Pterodactyl, besides that I just try to do something."
language: "en"
available_languages: ["en"]
header_img: "header-x"
cta: "product"
---

## Introduction

This article will help you transfer your Pterodactyl (1.X) software to a new server without losing any panel or Wings customisation, (game) server files, databases, backups and server-assigned specifications. In the end, your panel will be securely transferred without any loss of data.

**Please pay attention on which server you have to execute the mentioned commands.**

**Prerequisites**

* Root access to 2 Linux servers with supported Operating Systems (https://pterodactyl.io/panel/1.0/getting_started.html#picking-a-server-os)

## Step 1 - `Copying Wings files`

We'll start by migrating Wings, as this section usually contains the largest files. We can have these files uploading to the new server while we proceed to the next steps. You can skip this step if you don't have Wings installed.

### Step 1.1 - `Stopping your (game) servers and disabling access`

First of all log into your panel (as admin user) and **stop all your servers** to avoid data corruption.
Then connect to your **old** server via SSH (root user) and run these commands to prevent panel access + to stop Wings and prevent it from starting at boot:

```bash
cd /var/www/pterodactyl
php artisan down
systemctl disable --now wings
```

### Step 1.2 - `Compressing the files`

Let's move the files to the same directory and compress them afterwards.

```bash
# Create the directory and move the files
mkdir -p /wings-migration/files
mv /usr/local/bin/wings /wings-migration
mv /etc/pterodactyl/config.yml /wings-migration
mv /var/lib/pterodactyl /wings-migration/files

# Compress the directory (use -czf instead of -czvf to disable visual output)
cd /
tar -czvf wings-migration.tar.gz /wings-migration
```

*Step 1.2, 1.3 and 1.4 may take some time, so feel free to start a second SSH session and get started on step 2, 3 and 4 in a chronological order.*

### Step 1.3 - `Copying the compressed file to the new server`

We will use SCP to copy the compressed file to the new server. This can take minutes to hours, depending on the file size and upload speed. Make sure you can leave the terminal open long enough.

```bash
# This command will request the root password of your new server
# Replace <NEW-IP> with the public IP address of your new server
scp wings-migration.tar.gz root@<NEW-IP>:/
```

### Step 1.4 - `Extracting the file on the new server`

After the file has been copied completely, open a **new SSH terminal**. Log in to your **new** server as root user and execute these commands:

```bash
cd /
mkdir /wings-migration

# Extract the file (use -czf instead of -czvf to disable visual output)
tar -xzvf wings-migration.tar.gz -C /wings-migration
```

### Step 1.5 - `Moving the extracted files to the right directories`

Wait until everything is extracted and execute these commands afterwards:

```bash
shopt -s dotglob
mkdir -p /etc/pterodactyl
mkdir -p /var/lib/pterodactyl
mv /wings-migration/wings-migration/wings /usr/local/bin
mv /wings-migration/wings-migration/config.yml /etc/pterodactyl
mv /wings-migration/wings-migration/files/pterodactyl/* /var/lib/pterodactyl
```

Now all the files are in their right directory.

## Step 2 - `Copying panel files`

Let's copy the panel files, so that adjustments (such as addons, themes, ...) are preserved.

### Step 2.1 - `Changing DNS and disabling queue worker`

First of all, if you own a domain update your DNS settings. Set the target of your panel record to your new IP address. After that, run this command on your **old** server to stop its Pterodactyl service.

```bash
systemctl disable --now pteroq
```

### Step 2.2 - `Compressing the files`

Let's move the files to the same directory and compress them afterwards.

```bash
# Create the directory and move the files
mkdir /panel-migration
mv /var/www/pterodactyl /panel-migration

# Compress the directory (use -czf instead of -czvf to disable visual output)
cd /
tar -czvf panel-migration.tar.gz /panel-migration
```

### Step 2.3 - `Copying the compressed file to the new server`

We will use SCP to copy the compressed file to the new server. This should be faster than step 1.3.

```bash
# This command will request the root password of your new server
# Replace <NEW-IP> with the public IP address of your new server
scp panel-migration.tar.gz root@<NEW-IP>:/
```

### Step 2.4 - `Extracting the file on the new server`

After the file has been copied completely, go back to the SSH terminal of your **new** server and execute these commands:

```bash
cd /
mkdir /wings-migration

# Extract the file (use -czf instead of -czvf to disable visual output)
tar -xzvf wings-migration.tar.gz -C /wings-migration
```

### Step 2.5 - `Moving the extracted files to the right directory`

Wait until everything is extracted and execute these commands afterwards:

```bash
shopt -s dotglob
mkdir -p /var/www/pterodactyl
mv /panel-migration/panel-migration/pterodactyl/* /var/www/pterodactyl
```

Now all the files are in their right directory.

## Step 3 - `Migrating the databases`

In this step we will create the database users and migrate the databases.

### Step 3.1 - `Dependency installation`

Only execute the following steps from the documentation! **Do not go further!** Execute this on your **new** server. The documentation assumes you are running Ubuntu.
* **[Example Dependency Installation](https://pterodactyl.io/panel/1.0/getting_started.html#example-dependency-installation)**
* **[Installing Composer](https://pterodactyl.io/panel/1.0/getting_started.html#installing-composer)**

### Step 3.2 - `Creating the database users`

First, let's search the password you were using for your database connection. Execute the following command and look for this line: *DB_PASSWORD=*
```bash
# Works on both your new and old server
nano /var/www/pterodactyl/.env
```

Select the password to copy it and paste it in a safe place. Exit the file with **CTRL + X**.

Let's create the users on our **new** server:
```bash
# This will ask for your MySQL root password
# If you don't remember it, you probably don't have one
mysql -u root -p

# For this user, change <PASSWORD> to the password you saved
CREATE USER 'pterodactyl'@'127.0.0.1' IDENTIFIED BY '<PASSWORD>';
CREATE DATABASE panel;
GRANT ALL PRIVILEGES ON panel.* TO 'pterodactyl'@'127.0.0.1' WITH GRANT OPTION;

# For this user, generate a new password and save it for later
CREATE USER 'pterodactyluser'@'127.0.0.1' IDENTIFIED BY '<GENERATED-PASSWORD>';
GRANT ALL PRIVILEGES ON *.* TO 'pterodactyluser'@'127.0.0.1' WITH GRANT OPTION;
exit

# Create the directory needed in the following step
mkdir /databases-migration
```

### Step 3.3 - `Exporting the database`

Open the SSH terminal of your **old** server and execute the following commands to export and transfer your database.

```bash
mkdir /databases-migration

# This will ask for your MySQL root password
mysqldump -u root -p --opt panel > /databases-migration/panel-backup.sql

# This command will request the root password of your new server
# Replace <NEW-IP> with the public IP address of your new server
scp /databases-migration/panel-backup.sql root@<NEW-IP>:/databases-migration
```

### Step 3.4 - `Importing the database`

Now switch to your **new** server and execute this command to import the database.

```bash
# This will ask for your MySQL root password
mysql -u root -p panel < /databases-migration/panel-backup.sql
```

### Step 3.5 - `Server-assigned databases`

Only do this step if you have server-assigned databases.

To list all the databases you have, execute these commands on your **old** server.

```bash
# This will ask for your MySQL root password
mysql -u root -p

SHOW DATABASES;
```

Create each database that belongs to a (game) server:

```bash
CREATE DATABASE <name1>;
CREATE DATABASE <name2>;
...

# To exit MySQL
exit
```

Repeat step 3.3 and 3.4 with the databases you just created to migrate server-assigned databases. 

## Step 4 - `Making the panel accessible`

In this step we will make our panel accessible. Make sure you've completed step 2 and 3 first.

### Step 4.1 - `Crontab configuration and queue worker`

Only execute the following steps from the documentation! **Do not go further!** Execute this on your **new** server. The documentation assumes you are running Ubuntu.
* **[Crontab Configuration](https://pterodactyl.io/panel/1.0/getting_started.html#crontab-configuration)**
* **[Create Queue Worker](https://pterodactyl.io/panel/1.0/getting_started.html#create-queue-worker)**

### Step 4.2 - `Webserver configuration`

Configure Nginx on your **new** server. The documentation assumes you are running Ubuntu.
* **[Webserver Configuration](https://pterodactyl.io/panel/1.0/webserver_configuration.html)**

### Step 4.3 - `Enable panel access`

Execute these commands to get access to your panel.

```bash
cd /var/www/pterodactyl
php artisan up
```

Well done! You should have access to your panel now. If something is wrong, contact me via Discord: **Niels#8662**. Now it's time to connect Wings.

## Step 5 - `Connecting Wings`

In this step we will connect our panel to Wings. Make sure you've completed step 1 and 4 first. Skip this step if you didn't transfer Wings.

### Step 5.1 - `Installing Docker and enabling swap`

Only execute the following steps from the documentation! **Do not go further!** Execute this on your **new** server. The documentation assumes you are running Ubuntu.
* **[Installing Docker](https://pterodactyl.io/wings/1.0/installing.html#installing-docker)**
* **[Start Docker on Boot](https://pterodactyl.io/wings/1.0/installing.html#start-docker-on-boot)**
* **[Enabling Swap](https://pterodactyl.io/wings/1.0/installing.html#enabling-swap)**

### Step 5.2 - `Linking the configuration`

Go to your panel -> admin area -> nodes -> your transferred node -> **settings** and  make sure that Fully Qualified Domain Name is set to one of the following:
* Your panel's domain name
* Another DNS records that points to your new server's IP
* Your new server's IP, if you're not using SSL

Then go to the **configuration** tab and click Generate Token. Execute the generated command in your **new** server.

### Step 5.3 - `Daemonizing Wings`

Only execute the following step from the documentation! **Do not go further!** Execute this on your **new** server. The documentation assumes you are running Ubuntu.
* **[Daemonizing (using systemd)](https://pterodactyl.io/wings/1.0/installing.html#daemonizing-using-systemd)**

### Step 5.4 - `Updating allocations`

Now let's update our node allocations, so our Docker containers will use the new IP address.

```bash
# This will ask for your MySQL root password
mysql -u root -p

# Replace <NEW-IP> and <OLD-IP>
UPDATE panel.allocations SET ip = '<NEW-IP>' WHERE ip = '<OLD-IP>';
exit
```

That's it! Everything should work. If something is wrong, contact me via Discord: **Niels#8662**.

## Step 6 - `Removing unnecessary things`

If everything is working, you should remove some things. Make sure you completed every previous step! Execute these commands on your **old** server:

```bash
# Use -r instead of -rv to disable visual output
rm -rv /wings-migration
rm -rv /panel-migration
rm -rv /databases-migration
rm -v /etc/systemd/system/pteroq.service
rm -v /etc/systemd/system/wings.service
rm -v /etc/nginx/sites-available/pterodactyl.conf
systemctl restart nginx
```

Run the following command on your **old** server and remove the commented line from the file. There might also be a certbot line, remove that too.
```bash
# Remove this and exit the file with CTRL + X:
# * * * * * php /var/www/pterodactyl/artisan schedule:run >> /dev/null 2>&1
crontab -e
```

Execute these commands on your **new** server:

```bash
# Use -r instead of -rv to disable visual output
rm -rv /wings-migration
rm -rv /panel-migration
rm -rv /databases-migration
```

You are free to skip this part, but to remove some Pterodactyl dependencies from your **old** server, use this command:

```bash
apt -y purge php8.1 php8.1-{common,cli,gd,mysql,mbstring,bcmath,xml,fpm,curl,zip} mariadb-server nginx tar unzip git redis-server certbot python3-certbot-nginx python3-certbot-apache
```

## Conclusion

This is a step-by-step guide that explains how to migrate your Pterodactyl panel and servers to a new server. Everything is explained in detail so that Linux beginners can follow. Thanks for reading this guide, you can always contact me when you are having problems or to thank me for this guide via Discord: **Niels#8662**.

##### License: MIT

<!--

Contributor's Certificate of Origin

By making a contribution to this project, I certify that:

(a) The contribution was created in whole or in part by me and I have
    the right to submit it under the license indicated in the file; or

(b) The contribution is based upon previous work that, to the best of my
    knowledge, is covered under an appropriate license and I have the
    right under that license to submit that work with modifications,
    whether created in whole or in part by me, under the same license
    (unless I am permitted to submit under a different license), as
    indicated in the file; or

(c) The contribution was provided directly to me by some other person
    who certified (a), (b) or (c) and I have not modified it.

(d) I understand and agree that this project and the contribution are
    public and that a record of the contribution (including all personal
    information I submit with it, including my sign-off) is maintained
    indefinitely and may be redistributed consistent with this project
    or the license(s) involved.

Signed-off-by: Niels Leemans (niels.leemans1@gmail.com)

-->
